# 直播间问题  实验报告

### 陈家豪 19307130210



## 回答问题

### Question 1:

用户对直播间资源的占用可抽象成变量user_num[3]，表示观看3部影片的用户人数，各用户进程和直播间进程会共同访问这个变量，新用户进入直播间使其增加，离开使其减少，直播间需要访问该变量以确定播放还是停止。进程间需互斥访问user_num[3]。

可以有无数用户进程同时观看一部影片。



### Question 2:

2个进程：

直播间进程：

​		等待第一个用户进场	

​		循环1～3部影片{

​				查看等待看影片i的人数：

​				若有人在等待看影片i {

​						sem_post(&mutex_film[i]);  将影片i设为播放状态，允许用户进入	

​						while(time(NULL)<film_end_time){//电影放映时间内	

​								每隔1s检查一次在看人数，若为0则break

​						}

​						影片时间到或没人看，停止播放并等待所有观看者退出

​				}

​				检查是否有人在排队，若有人则继续循环，没人就退出循环继续等待

​		}



用户进程：

​		若该用户为看影片i的第一人，设置标志mutex_out[i]=0（该标志在看影片i的最后一人离开时设置为1，作用是实现直播间进程等待所有用户都离开后再继续下一步）		

​		sem_post(&mutex1)，提示直播间进程开始播放

​		等待影片播放

​		观看影片，设置观看时间

​		若时间到或影片结束放映，用户退出

​		将user_num[i]--

​		sem_wait(&mutex1)